<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Kick Transient Granular Morph</title>
<style>
body {
  background: #0f0f0f;
  color: #e0e0e0;
  font-family: system-ui, sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  height: 100vh;
  margin: 0;
  padding: 1rem;
}
canvas {
  border: 1px solid #333;
  background: #181818;
  border-radius: 8px;
  margin: 1rem 0;
}
.controls {
  display: flex;
  gap: 1.5rem;
  align-items: center;
  width: 80%;
  justify-content: center;
}
input[type=range] {
  width: 300px;
}
label {
  min-width: 70px;
  text-align: right;
}
h2 {
  font-weight: 600;
  margin: 0.5rem 0;
  text-shadow: 0 0 10px #0ff;
}
</style>
</head>
<body>
<h1>ðŸŽ§ Kick Transient Granular Morph</h1>
<h2 id="familyName">TinyClick</h2>
<canvas id="canvas" width="800" height="200"></canvas>

<div class="controls">
  <label>Morph</label>
  <input id="morph" type="range" min="0" max="10000" value="0" step="1">
  <span id="morphVal">0</span>
</div>

<p>Press <strong>[SPACEBAR]</strong> to trigger sound ðŸ”Š</p>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const morphSlider = document.getElementById("morph");
const morphVal = document.getElementById("morphVal");
const familyNameEl = document.getElementById("familyName");

let morph = 0;
let audioCtx = null;
const sampleRate = 44100;

// 12 granular kick-style transient families
const families = [
  { name:"TinyClick", color:"#0f0", f:(x,a)=> (Math.random()-0.5)*Math.exp(-1500*x*(0.3+0.7*a)) },
  { name:"ShortPop", color:"#ff6", f:(x,a)=> Math.sin(2*Math.PI*2000*x)*Math.exp(-100*x*(0.3+0.7*(1-a))) },
  { name:"WoodTap", color:"#f66", f:(x,a)=> Math.sin(2*Math.PI*400*x)*Math.exp(-60*x*(0.4+0.6*a)) },
  { name:"KnockLow", color:"#9f6", f:(x,a)=> Math.sin(2*Math.PI*(80+200*a)*x)*Math.exp(-40*x) },
  { name:"Thump", color:"#f9f", f:(x,a)=> Math.sin(2*Math.PI*60*x)*Math.exp(-15*x*(0.3+0.7*a)) },
  { name:"BodyPop", color:"#ff9", f:(x,a)=> Math.sin(2*Math.PI*150*x)*Math.exp(-20*x*(0.5+0.5*a)) },
  { name:"MidSlap", color:"#6ff", f:(x,a)=> Math.sin(2*Math.PI*(200+400*a)*x)*Math.exp(-25*x) },
  { name:"Punch", color:"#f60", f:(x,a)=> Math.sin(2*Math.PI*120*x)*Math.exp(-10*x*(0.3+0.7*a)) },
  { name:"DeepPunch", color:"#fc0", f:(x,a)=> Math.sin(2*Math.PI*80*x)*Math.exp(-8*x*(0.4+0.6*a)) },
  { name:"WarmTap", color:"#0ff", f:(x,a)=> Math.tanh(Math.sin(2*Math.PI*300*x)*(1+3*a))*Math.exp(-12*x) },
  { name:"TapeClick", color:"#f0f", f:(x,a)=> Math.tanh(Math.sin(2*Math.PI*200*x)*(1+4*a))*Math.exp(-15*x) },
  { name:"AnalogCrack", color:"#0af", f:(x,a)=> Math.tanh(Math.sin(2*Math.PI*150*x)*(1+5*a))*Math.exp(-20*x) },
];

// Generate waveform based on morph parameter
function generateWave(morph){
  const pos = morph/10000 * (families.length-1+0.9999); // fix last family reach
  const i0 = Math.floor(pos);
  const i1 = Math.min(i0+1,families.length-1);
  const frac = pos - i0;
  const n = 512;
  const data = new Float32Array(n);
  for(let i=0;i<n;i++){
    const x=i/n;
    const v0=families[i0].f(x,0.5);
    const v1=families[i1].f(x,0.5);
    data[i]=v0*(1-frac)+v1*frac;
  }
  return {data, color:families[i0].color, name:families[i0].name};
}

// Draw waveform
function drawWave(){
  const {data,color,name}=generateWave(morph);
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.beginPath();
  const mid=canvas.height/2;
  for(let i=0;i<data.length;i++){
    const x=(i/data.length)*canvas.width;
    const y=mid - data[i]*mid*0.8;
    if(i===0) ctx.moveTo(x,y);
    else ctx.lineTo(x,y);
  }
  ctx.strokeStyle=color;
  ctx.lineWidth=2;
  ctx.stroke();
  familyNameEl.textContent=name;
  familyNameEl.style.color=color;
  document.title=`Transient: ${name}`;
}

// Play transient sound
function playSound(){
  if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  const {data}=generateWave(morph);
  const buffer=audioCtx.createBuffer(1,data.length,sampleRate);
  buffer.copyToChannel(data,0);
  const src=audioCtx.createBufferSource();
  src.buffer=buffer;
  src.connect(audioCtx.destination);
  src.start();
}

// Event listeners
morphSlider.addEventListener("input",e=>{
  morph=e.target.value/1;
  morphVal.textContent=e.target.value;
  drawWave();
});

document.body.addEventListener("keydown",e=>{
  if(e.code==="Space"){ e.preventDefault(); playSound(); }
});

// Initial draw
drawWave();
</script>
</body>
</html>
